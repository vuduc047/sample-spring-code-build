ARG CODEARTIFACT_AUTH_TOKEN
# Use a base image that includes Java 17 and Maven
FROM maven:3.9.1 AS build
ENV CODEARTIFACT_AUTH_TOKEN=eyJ2ZXIiOjEsImlzdSI6MTY4NzI1ODI0NSwiZW5jIjoiQTEyOEdDTSIsInRhZyI6IlBZY2VGR2h3SmpjS1hZTVM1UkVfdWciLCJleHAiOjE2ODczMDE0NDUsImFsZyI6IkExMjhHQ01LVyIsIml2IjoiMFB0OUNXTGJRTVZ1MzdEbCJ9.T55XzOqN5Dkqblm-TOm_yQ.zO6s7iGN5oh-8OSA.Tt0YItgsPpLJ-greRT24jh-DeJxM_wSxjBzkwWVZWc91SYah2gl61QgFGrJ-hc0tiBaBpxunOm0nbcZ7Li8BX2CIyYdUwPM8k2ydiFNdT-6YJep6OgZNi2yDKUPzVhaH-CitHCgyBU8WBTO27eejGZ_-xejptMKWpm0sD4oDwGm1H8l8xKN0vBMCirPGWv89QW_tDdj4s2pC1xg1ssdd4S5s4fRnIlysYXSW_JTuFI9Jr7rfIV28sZKKulvC4vZmgyot6UIGBQG6fybwEcCWlVJjOy5hL6_P3-GvS2uQidjs0jv_QGdzWfAnfguZeYROpeeB-QJPfwLa2jzn-ypEYRQxXfWZWFqVBs1NDGsX2LM8QbxpiLt0bviYWQWnKaJDlrUTU6zGPuqX6LFK5F9SrB9TB4XdwyZRVOVWGKBMdeWmVZxsoffoFjbc212aa3Ueo1FbYQVBPs4Xg20Lyl0-nhUihvhKmNtkphBEjyI1DHRQP9dDyDE33Gbg8ePcFEqGMvFhjoO3kZ8VCluwb4ZG1A-po1f9j4hYA48l-_Gn54cmrEwm8HQI5RLZSkaylfLxxQfNAIIR2MItj-fQOKqBQfndSc2McIiFGCCVt9l57Rmorq2W56lInTUCNAMIQknvb1JFec22swXAtwW-dr53j7erA0LdKS_0LNtRCfsS2ORbvMMGISYswcNcQVJulOXGDKIkjWDVr1QU5mMdAmVnQUmz5O4X-a7UdBHpcJs85W_Iduno43f_0KIvD8MWRt_mIk24IsJp-6nKAArNkK0Oc2BI0VOTrUQw5jIi7C-JW_fOjAmRfq0YU0kGmz624JmGFXLEKV2sJaimd2j416Ua16KDf4IuZuexUkMgm-flvlswQKVI36oE_2MP-UUlZ0vH_guAAPFb08OuFpZbzwzvLVv4R2FMIPsPTJTTwym5J0Hroh-dkvXdCrr3kGCqq0d_mCV4MCWXWV7aJwfM9PapjhDUNtMJATSTgJaVjiq3B4ipvIP-tcO623wQV3UHjC-Ro_uJgNFGSGyPHAbkH-9a0m94WLy9R5g1CLJ58A3fODpmmk0K0HbspdYf5N8Q_OxorB7au6-WEjFC_ZWiXZkG7zVheaIKsx0RwD0A5ZFftCeyGz0py8eUplyqFowlHfZOdKJpVNo.CzRMOP1pM9UFiW4bh6zNtg
WORKDIR /app
COPY pom.xml .
COPY src/ ./src/
COPY settings.xml .
RUN mvn clean install
RUN mvn deploy -s settings.xml

# Start a new container with Java 17 and Alpine Linux, with Amazon Corretto
FROM maven:3.9.0-amazoncorretto-17
WORKDIR /app
COPY --from=build "/app/target/*.jar" /app/
EXPOSE 6969
ENTRYPOINT java -jar *.jar